<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Guindaille 2.0 - Quiz</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@700&display=swap" rel="stylesheet">
  <style>
    :root {
      --main-pink: #d6006d;
      --main-black: #111;
      --main-white: #fff;
      --font-size-base: 1.25em;
      --font-size-mobile: 1.1em;
    }
    html {
      font-size: var(--font-size-base);
    }
    body {
      background: var(--main-pink);
      font-family: 'Baloo 2', Arial, sans-serif;
      margin: 0;
      min-height: 100vh;
    }
    .quiz-container {
      max-width: 500px;
      margin: 24px auto;
      background: var(--main-white);
      border-radius: 24px;
      box-shadow: 0 4px 32px rgba(0,0,0,0.12);
      padding: 24px 16px 16px 16px;
      position: relative;
      width: 95vw;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
    }
    .header {
      text-align: center;
      margin-bottom: 16px;
    }
    .header-title {
      color: var(--main-white);
      font-size: 2.4em;
      font-weight: bold;
      letter-spacing: 1px;
      margin-bottom: 0;
      margin-top: 0;
      text-shadow: 0 2px 8px #0002;
    }
    .logo-circle {
      background: var(--main-black);
      color: var(--main-white);
      width: 90px;
      height: 90px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.2em;
      font-weight: bold;
      margin: 0 auto 10px auto;
      box-shadow: 0 2px 12px #0003;
    }
    .category-intro {
      text-align: center;
      margin: 24px 0 12px 0;
    }
    .category-title {
      color: var(--main-pink);
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 12px;
    }
    .category-btn {
      background: var(--main-black);
      color: var(--main-white);
      border: none;
      border-radius: 24px;
      padding: 16px 0;
      font-size: 1.3em;
      font-family: 'Baloo 2', Arial, sans-serif;
      cursor: pointer;
      margin-top: 18px;
      width: 100%;
      max-width: 320px;
      display: block;
      margin-left: auto;
      margin-right: auto;
      transition: background 0.2s;
    }
    .category-btn:hover {
      background: #333;
    }
    .question {
      font-size: 1.25em;
      color: var(--main-pink);
      margin-bottom: 18px;
      text-align: center;
      font-weight: bold;
      line-height: 1.3;
    }
    .slider-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 18px;
      width: 100%;
    }
    .slider {
      width: 100%;
      max-width: 350px;
      accent-color: var(--main-pink);
      margin-bottom: 8px;
      height: 36px;
      touch-action: pan-x;
    }
    .slider-value {
      font-size: 1.7em;
      color: var(--main-black);
      font-weight: bold;
      background: #eee;
      border-radius: 12px;
      padding: 8px 26px;
      margin-top: 4px;
      margin-bottom: 8px;
      display: inline-block;
    }
    .submit-btn, .next-btn {
      background: var(--main-pink);
      color: var(--main-white);
      border: none;
      border-radius: 24px;
      padding: 16px 0;
      font-size: 1.3em;
      font-family: 'Baloo 2', Arial, sans-serif;
      cursor: pointer;
      width: 100%;
      max-width: 320px;
      display: block;
      margin: 16px auto 0 auto;
      transition: background 0.2s;
    }
    .submit-btn[hidden], .next-btn[hidden] {
      display: none;
    }
    .submit-btn:hover, .next-btn:hover {
      background: #b00056;
    }
    .result {
      margin-top: 18px;
      font-size: 1.2em;
      text-align: center;
      font-weight: bold;
    }
    .result.good {
      color: #1bbf5c;
    }
    .result.medium {
      color: #f7b500;
    }
    .result.bad {
      color: #d6006d;
    }
    .explanation {
      margin-top: 10px;
      font-style: italic;
      color: #555;
      text-align: center;
      font-size: 1.1em;
      line-height: 1.3;
    }
    .score {
      margin-top: 32px;
      font-size: 1.25em;
      color: var(--main-pink);
      text-align: center;
      font-weight: bold;
    }
    .final-score-circle {
      background: var(--main-black);
      color: var(--main-white);
      width: 80px;
      height: 80px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2em;
      font-weight: bold;
      margin: 18px auto 12px auto;
      box-shadow: 0 2px 12px #0003;
    }
    @media (max-width: 600px) {
      html {
        font-size: var(--font-size-mobile);
      }
      .quiz-container {
        max-width: 100vw;
        width: 99vw;
        padding: 4vw 2vw 2vw 2vw;
      }
      .header-title {
        font-size: 1.7em;
      }
      .logo-circle {
        width: 60px;
        height: 60px;
        font-size: 1.2em;
      }
      .category-title {
        font-size: 1.2em;
      }
      .question {
        font-size: 1.15em;
      }
      .slider {
        max-width: 98vw;
        height: 36px;
      }
      .slider-value {
        font-size: 1.3em;
        padding: 8px 16px;
      }
      .submit-btn, .category-btn, .next-btn {
        font-size: 1.1em;
        padding: 14px 0;
        max-width: 98vw;
      }
      .final-score-circle {
        width: 60px;
        height: 60px;
        font-size: 1.2em;
      }
      .score {
        font-size: 1.1em;
      }
    }
  </style>
</head>
<body>
  <div class="header" style="background: var(--main-pink); padding: 18px 0 6px 0;">
    <div class="header-title">Guindaille</div>
    <div class="logo-circle">2.0</div>
  </div>
  <div class="quiz-container" id="quizContainer">
    <!-- Tout le contenu dynamique sera inject√© ici -->
  </div>
  <script>
    // --- DATA ---
    const categories = [
      {
        title: "Consommation et habitudes",
        certaintyQuestion: "Tu te mets combien √† propos de tes connaissances sur la consommation et les habitudes des √©tudiants ?",
        questions: [
          {
            text: "A. Selon toi, un √©tudiant consomme de l'alcool combien de jours par semaine en moyenne ?",
            answer: 2,
            explanation: "La moyenne est √† 2 jours par semaine. √âtonnant lorsque qu'on sait qu'une bonne partie des √©tudiants pensent que celle-ci est √† 4 jours par semaine."
          },
          {
            text: "B. Sachant qu‚Äôun √©tudiant sur 4 dit √™tre ivre au moins une fois par semaine, combien d‚Äôentre eux sur 10 disent √™tre consommateur quotidien ?",
            answer: 1,
            explanation: "Parmi ces consommateurs, 1 √©tudiant sur 10 dit consommer de l‚Äôalcool quotidiennement, tandis que 10% affirment qu‚Äôils ne boivent pas."
          },
          {
            text: "C. D‚Äôapr√®s toi, combien d‚Äô√©tudiants sur 10 pratiquent le binge-drinking ?",
            answer: 5,
            explanation: "La moiti√© des √©tudiants consomment rapidement de l‚Äôalcool (et finissent souvent bourr√©s). Ils consomment en moyenne 2 verres par heure."
          }
        ]
      },
      {
        title: "Risques et cons√©quences",
        certaintyQuestion: "Tu te mets combien √† propos de tes connaissances sur les risques et cons√©quences li√©es √† l'alcool ?",
        questions: [
          {
            text: "D. Autour de quelle quantit√© d‚Äô√©tudiants sur 10 ont une consommation nocive d‚Äôalcool ?",
            answer: 6,
            explanation: "Plus de la moiti√© (56%). Ce r√©sultat provient du test AUDIT qui √©tablit 3 cat√©gories sur base d‚Äôun score allant de 1 √† 40 : Low-risk, consommation nocive, ou dangereuse/√† risque de d√©pendance √† l‚Äôalcool."
          },
          {
            text: "E. Sur base du test AUDIT, environ quel quantit√© d‚Äô√©tudiants de l‚ÄôUCLouvain (sur 10) a une consommation dangereuse d‚Äôalcool ?",
            answer: 1,
            explanation: "13% des √©tudiants ont une consommation qui tend vers la d√©pendance √† l‚Äôalcool. Pour information, le score du test AUDIT est bas√© sur 3 variables, la fr√©quence et quantit√© de la consommation d‚Äôalcool, la possibilit√© de d√©pendance √† l‚Äôalcool et les exp√©riences de dommages li√©s √† l‚Äôalcool. N‚Äôh√©site pas √† faire le test (https://santesecu.public.lu/dam-assets/fr/prevention/alcool/dependance/test-audit.pdf)"
          },
          {
            text: "F. D‚Äôapr√®s toi, combien d‚Äô√©tudiant sur 10 avouent avoir d√©j√† conduit sous l‚Äôinfluence de l‚Äôalcool ?",
            answer: 2,
            explanation: "En moyenne, 2 √©tudiants sur 10 avouent avoir conduit sous l'influence de l'alcool. Il faut savoir que l‚Äôeffet d√©sinhibant de l‚Äôalcool am√®ne √† sous-√©valuer les risques et √† surestimer ses capacit√©s alors que m√™me √† petite dose, l‚Äôalcool agit directement sur le cerveau ! Boire ou conduire, il faut choisir üòâ"
          }
        ]
      },
      {
        title: "Perception et influence sociale",
        certaintyQuestion: "Tu te mets combien √† propos de tes connaissances sur la perception et l'influence sociale li√©es √† l'alcool ?",
        questions: [
          {
            text: "G. Selon toi, quelle quantit√© d‚Äô√©tudiants planifie ses journ√©es autour de l‚Äôalcool et de la guindaille ?",
            answer: 5,
            explanation: "C‚Äôest le cas de pr√®s de la moiti√© des √©tudiants de Louvain-la-Neuve. Pas √©tonnant lorsqu‚Äôon sait que la moiti√© des √©tudiants disent √™tre incapable d‚Äô√©tudier ou de travailler √† cause de l‚Äôalcool, et que 41% des √©tudiants disent que cela perturbe leurs √©tudes."
          },
          {
            text: "H. Selon toi, quelle quantit√© d'√©tudiant sur 10 estime que c'est mal vu de ne pas boire de l'alcool en soir√©e?",
            answer: 2,
            explanation: "Pr√®s d'un √©tudiant sur 5 est en accord avec le fait que les non-buveurs sont mal vu en soir√©e, et 38% des √©tudiants estiment qu'il est difficile de s'int√©grer socialement si on ne boit pas d'alcool."
          },
          {
            text: "I. √Ä ton avis quel est le pourcentage d'√©tudiants √† l'UCLouvain qui boivent en soir√©e (entre-autres) parce que les ami.e.s y ont pouss√© ?",
            answer: 5,
            explanation: "51% des √©tudiants de l'UCLouvain interrog√©s l'ont identifi√© comme une des motivations √† boire. Si on √©largit aux jeunes de 18-34 ans en Wallonie, ce nombre descend √† 25%. C'est donc un ph√©nom√®ne particuli√®rement pr√©sent √† l'UCLouvain."
          },
          {
            text: "J. Sur une √©chelle de 1 √† 10, comment estimes-tu le soutien offert aux √©tudiants qui rencontrent des probl√®mes li√©s √† l‚Äôalcool ?",
            answer: 4,
            explanation: "La perception moyenne du niveau de soutien est de 4 sur 10."
          }
        ]
      }
    ];

    // --- STATE ---
    let currentCategory = 0;
    let currentQuestion = -2; // -2: intro, -1: certitude, >=0: question
    let certaintyScores = [];
    let categoryScores = [];
    let userAnswers = [];
    let malusByCategory = [];
    let awaitingNext = false; // Ajout d'un √©tat pour attendre le "Suivant"

    // --- RENDERING ---
    const quizContainer = document.getElementById('quizContainer');

    function renderCategoryIntro() {
      quizContainer.innerHTML = `
        <div class="category-intro">
          <div class="category-title">${categories[currentCategory].title}</div>
          <button class="category-btn" id="nextCategoryBtn">Suivant</button>
        </div>
      `;
      document.getElementById('nextCategoryBtn').onclick = () => {
        currentQuestion = -1;
        renderCertaintyQuestion();
      };
    }

    function renderCertaintyQuestion() {
      quizContainer.innerHTML = `
        <div class="question">${categories[currentCategory].certaintyQuestion}</div>
        <div class="slider-container">
          <input type="range" min="1" max="10" value="5" class="slider" id="slider">
          <span class="slider-value" id="sliderValue">5</span>
        </div>
        <button class="submit-btn" id="submitBtn">Valider</button>
      `;
      const slider = document.getElementById('slider');
      const sliderValue = document.getElementById('sliderValue');
      slider.oninput = () => sliderValue.textContent = slider.value;
      document.getElementById('submitBtn').onclick = () => {
        certaintyScores[currentCategory] = parseInt(slider.value, 10);
        currentQuestion = 0;
        renderQuestion();
      };
    }

    function renderQuestion() {
      const q = categories[currentCategory].questions[currentQuestion];
      quizContainer.innerHTML = `
        <div class="question">${q.text}</div>
        <div class="slider-container">
          <input type="range" min="1" max="10" value="5" class="slider" id="slider">
          <span class="slider-value" id="sliderValue">5</span>
        </div>
        <button class="submit-btn" id="submitBtn">Valider</button>
        <div class="result" id="result"></div>
        <div class="explanation" id="explanation"></div>
        <button class="next-btn" id="nextBtn" hidden>Suivant</button>
      `;
      const slider = document.getElementById('slider');
      const sliderValue = document.getElementById('sliderValue');
      slider.oninput = () => sliderValue.textContent = slider.value;
      document.getElementById('submitBtn').onclick = () => {
        // Masquer le bouton "Valider"
        document.getElementById('submitBtn').hidden = true;
        handleAnswer(parseInt(slider.value, 10));
      };
    }

    function handleAnswer(userValue) {
      const q = categories[currentCategory].questions[currentQuestion];
      const diff = Math.abs(userValue - q.answer);
      let pts = 0;
      let malus = 0;
      let resultClass = "bad";
      if (diff === 0) { pts = 1; resultClass = "good"; }
      else if (diff === 1) { pts = 0.75; resultClass = "medium"; }
      else if (diff === 2) { pts = 0.25; resultClass = "medium"; }
      else { malus = -0.5; resultClass = "bad"; }
      userAnswers.push({cat: currentCategory, q: currentQuestion, pts, malus, userValue, answer: q.answer});
      document.getElementById('result').textContent =
        diff === 0 ? "Bravo, r√©ponse exacte !" :
        diff === 1 ? "Presque ! Tu n'√©tais qu'√† 1 pr√®s." :
        diff === 2 ? "Pas loin, tu √©tais √† 2 pr√®s." :
        "Rat√© ! Tu perds 0,5 point.";
      document.getElementById('result').className = "result " + resultClass;
      document.getElementById('explanation').textContent = q.explanation;
      // Afficher le bouton "Suivant"
      document.getElementById('nextBtn').hidden = false;
      // Attendre le clic sur "Suivant"
      awaitingNext = true;
      document.getElementById('nextBtn').onclick = () => {
        if (awaitingNext) {
          awaitingNext = false;
          goToNext();
        }
      };
    }

    function goToNext() {
      currentQuestion++;
      if (currentQuestion < categories[currentCategory].questions.length) {
        renderQuestion();
      } else {
        // Calcul du score de la cat√©gorie
        const start = userAnswers.length - categories[currentCategory].questions.length;
        const end = userAnswers.length;
        let rawScore = userAnswers.slice(start, end).reduce((sum, ans) => sum + ans.pts, 0);
        let rawMalus = userAnswers.slice(start, end).reduce((sum, ans) => sum + ans.malus, 0);
        let coef = 1 + (certaintyScores[currentCategory] / 10);
        let scoreWithCoef = rawScore * coef;
        let malusWithCoef = rawMalus * coef;
        categoryScores[currentCategory] = +(scoreWithCoef + malusWithCoef).toFixed(2);
        malusByCategory[currentCategory] = +(malusWithCoef).toFixed(2);
        // Cat√©gorie suivante ou fin
        currentCategory++;
        if (currentCategory < categories.length) {
          currentQuestion = -2;
          renderCategoryIntro();
        } else {
          renderFinalScore();
        }
      }
    }

    function renderFinalScore() {
      const total = categoryScores.reduce((a, b) => a + b, 0);
      quizContainer.innerHTML = `
        <div class="final-score-circle">${total.toFixed(2)}</div>
        <div class="score">Score final (avec coefficients et malus) : <br><b>${total.toFixed(2)}</b></div>
        <div style="margin-top:24px;">
          ${categories.map((cat, i) =>
            `<div style="margin-bottom:10px;">
              <span style="color:var(--main-pink);font-weight:bold;">${cat.title}</span><br>
              Score (avec coef) : ${(categoryScores[i] - malusByCategory[i]).toFixed(2)}<br>
              Malus : ${malusByCategory[i]}<br>
              Coefficient : ${certaintyScores[i]}/10
            </div>`
          ).join('')}
        </div>
        <div style="margin-top:32px;text-align:center;">
          <button class="category-btn" onclick="location.reload()">Recommencer</button>
        </div>
      `;
    }

    // --- INIT ---
    renderCategoryIntro();
  </script>
</body>
</html>
